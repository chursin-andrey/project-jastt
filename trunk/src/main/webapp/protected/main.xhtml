<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"      
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    template="/templates/commonLayout.xhtml">
   	
	<ui:define name="content">
	<h:outputStylesheet name="css/main.css" />
		
	<h:form id="form">

	<h:panelGrid columns="3"   styleClass="top-control-panels" columnClasses="top-left-panel panel, top-center-panel panel, top-right-panel panel">
		<p:column >	
			<p:outputLabel value="Project:"/><br />
			<p:selectOneMenu id="project" value="#{reportBean.project_name}" styleClass="item" >
				<f:selectItem itemLabel="Please select a project... " noSelectionOption="true" />
   				<f:selectItems var="project" value="#{reportBean.projects}" itemValue="#{project.name}" itemLabel="#{project.name} " />
   				<f:ajax listener="#{reportBean.changeProject}" render="issue status assignees time" /> 
			</p:selectOneMenu>	
			<br />
			<p:outputLabel value="Members:"/><br />
			<p:selectCheckboxMenu id="assignees" value="#{reportBean.assignees_name}" label="Members" disabled="#{reportBean.disableMenu}" filter="true" filterMatchMode="startsWith" styleClass="item" >
        		<f:selectItems var="assignee" value="#{reportBean.assignees}" itemValue="#{assignee.name} " itemLabel="#{assignee.name} " />
        	</p:selectCheckboxMenu>	
		</p:column>
			
		<p:column>
			<p:outputLabel value="Task:"/><br />
			<p:selectOneMenu id="issue"  value="#{reportBean.issueType}" disabled="#{reportBean.disableMenu}" styleClass="item">
				<f:selectItem itemLabel="All " noSelectionOption="true" />
   				<f:selectItem itemValue="Bug" itemLabel="Bug" />
   				<f:selectItem itemValue="Improvement" itemLabel="Improvement" />
   				<f:selectItem itemValue="New feature" itemLabel="New feature" />
   				<f:selectItem itemValue="Task" itemLabel="Task" />
				<f:ajax listener="#{reportBean.changeIssue}" />
			</p:selectOneMenu>
			
			<br />
			<p:outputLabel value="Status:"/><br />
			<p:selectOneMenu id="status"  value="#{reportBean.status}" onchange="submit" immediate="true" disabled="#{reportBean.disableMenu}" styleClass="item">
				<f:selectItem itemLabel="All " noSelectionOption="true" />
				<f:selectItem itemValue="Open" itemLabel="Open" />
				<f:selectItem itemValue="In progress" itemLabel="In progress" />
				<f:selectItem itemValue="Resolved" itemLabel="Resolved" />
				<f:selectItem itemValue="Reopened" itemLabel="Reopened" />
				<f:selectItem itemValue="Closed" itemLabel="Closed" />
			</p:selectOneMenu>	
			
		</p:column>
		
		<p:column>
			<p:outputLabel value="Time:"/><br />
			
			<p:outputPanel>
				<p:selectOneRadio value="#{reportBean.timespent}" id="time"  layout="pageDirection" disabled="#{reportBean.disableMenu}" styleClass="radio" >
   						<f:selectItem itemValue="allTime" style="margin-bottom:10px;" itemLabel="" /> 
   						<f:selectItem itemValue="date" itemLabel="" />
   						<f:ajax listener="#{reportBean.changeTime}" render="issue allTime dateFrom dateTo" />
				</p:selectOneRadio>
				 
				 <p:selectOneMenu id="allTime" value="#{reportBean.timespent}" disabled="#{reportBean.disableSelectTime}"  styleClass="predefineddate">
   					<f:selectItem itemLabel="AllTime" noSelectionOption="true" />
				</p:selectOneMenu>
				<br />
				<div class="calendar-box">
					<p:outputLabel value="From: "/>
       				<p:calendar id="dateFrom" size="4" value="#{reportBean.dateFrom}" disabled="#{reportBean.disableSelectDate}" styleClass="calendar-item"/>
					<p:outputLabel value=" To: "/>
       			 	<p:calendar id="dateTo" size="4"  value="#{reportBean.dateTo}" disabled="#{reportBean.disableSelectDate}" styleClass="calendar-item"/> 
				</div>
			</p:outputPanel>
					
		</p:column>
		
	</h:panelGrid>
	

	<h:panelGrid columns="1" styleClass="main-buttons-panel panel" >
		<h:column>
			<p:commandButton value="Show" actionListener="#{reportBean.showReport()}" update="tabs" styleClass="main-buttons"/>
			<p:commandButton value="Clear" actionListener="#{reportBean.cancelAction()}" update="tabs" styleClass="main-buttons"/>
			<p:commandButton value="Update" action="#{reportBean.updateData()}" styleClass="main-buttons"/>
		</h:column>
	</h:panelGrid>
	
	
		<p:tabView activeIndex="0" id="tabs" styleClass="tabView">
			<p:tab title="Details">
					<p:dataTable var="details" value="#{reportBean.reportIssues}" id="Details" rowIndexVar="rowIndex" lazy="true" >
						<f:facet name="header">Total Elapsed Time              
    						<p:column datasource="Details" trigger="toggler"/>
                			<p:outputPanel>
                    				<h:outputText value="hours:"/> 
                    				<h:outputText value="#{reportBean.hours}"/>
                    				<h:outputText value="	minuts:"/>
                    				<h:outputText value="#{reportBean.minuts}"/>
                			</p:outputPanel>            
            			</f:facet>
            			<p:column headerText="№" >
            				<h:outputText  value="#{rowIndex+1}"  />
            			</p:column>
            			<p:column headerText="Date" >
            				<h:outputText  value="#{details.created}"  >
            					<f:convertDateTime pattern="dd.MM.yyyy" />
            				 </h:outputText>
            			</p:column>
						<p:column headerText="Member" >
							<h:outputText  value="#{details.assignee.name}"  />
               			</p:column>
						<p:column headerText="Project"  >
							<h:outputText  value="#{details.project.name}"  />
						</p:column>
						<p:column headerText="Task" >
							<h:outputText  value="#{details.issueType}"  />
						</p:column>
						<p:column headerText="Status" >
						 <h:outputText  value="#{details.status}"  />
						</p:column>
						<p:column headerText="Summary">
							<h:outputText  value="#{details.summary}"  />
						</p:column>
						<p:column headerText="Hours" >
							<h:outputText  value="#{details.timeSpent}"  />
						</p:column>
					</p:dataTable>
			</p:tab>
			
			
			
			
			
        	<p:tab title="Report">   
					<p:dataTable var="report" value="#{reportBean.reportIssues}" id="Report" rowIndexVar="rowIndex" lazy="true">
							 <f:facet name="header">Total Elapsed Time              
                				<p:column datasource="Report" trigger="toggler"/>
               					<p:outputPanel>
                    				<h:outputText value="hours:"/> 
                    				<h:outputText value="#{reportBean.hours}"/>
                    				<h:outputText value="	minuts:"/>
                    				<h:outputText value="#{reportBean.minuts}"/>
                				</p:outputPanel>
                			</f:facet>
                			<p:column style="width:16px">
            					<p:rowToggler />
        					</p:column>
        					<p:column headerText="№" style="width:50px">
            				<h:outputText  value="#{rowIndex+1}"  />
            			</p:column>
                			<p:column headerText="Member">
								<h:outputText  value="#{report.assignee.name}"  />
               				</p:column>
                			<p:column headerText="Hours">
								<h:outputText  value="#{report.timeSpent}"  />
							</p:column> 	
                		<p:rowExpansion> 
                		 <p:panelGrid  columns="8" columnClasses="label,value" style="width:700px">   
                		 
                		 	<h:outputText value="Member: " />
                			<h:outputText value="#{report.assignee.name}" />     			
							
							<h:outputText value="Project: " />
                			<h:outputText value="#{report.project.name}" /> 
                			
                			<h:outputText value="Task: " />
                			<h:outputText value="#{report.issueType}" /> 
                			
                			<h:outputText value="Hours: " />
                			<h:outputText value="#{report.timeSpent}" /> 
                			
							
							 </p:panelGrid>
						</p:rowExpansion> 
					</p:dataTable>
					
					
					
		
					<br/>
					
					<h:panelGrid columns="3" width="250">
						<h:commandButton value="Export to PDF" actionListener="#{reportBean.exportIssueList}">
							<f:param name="reportFormat" value="pdf"/>
						</h:commandButton>
						<h:commandButton value="Export to Xls" actionListener="#{reportBean.exportIssueList}">
							<f:param name="reportFormat" value="xls"/>
						</h:commandButton>
						<h:commandButton value="Export to Xlsx" actionListener="#{reportBean.exportIssueList}">
							<f:param name="reportFormat" value="xlsx"/>
						</h:commandButton>
					</h:panelGrid>
        	</p:tab>
    	</p:tabView>    		
</h:form>
	</ui:define>
</ui:composition>    