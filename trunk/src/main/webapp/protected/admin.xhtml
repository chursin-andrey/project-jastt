<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"      
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    template="/templates/commonLayout.xhtml">
	
	<ui:define name="content">
		<div align="left">
		<h:form >	
			<h:panelGrid>
				<p:commandButton value="Add User" type="button" onclick="PF('dlgUserInfo').show();"  />
			</h:panelGrid>
		 </h:form>
				
		<h:form id="userInfoForm">
			<p:dialog header="Create User Account" widgetVar="dlgUserInfo" modal="true">
				<p:messages id="messages" showDetail="true" autoUpdate="true" />
        		
        		<h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5">
        			<p:outputLabel for="name" value="Name:" />
					<p:inputText id="name" value="#{usersBean.name}" required="true" 
						disabled="#{usersBean.currentUserIsAdmin}" />
					
					<p:outputLabel for="login" value="Login:"/>
					<p:inputText id="login" value="#{usersBean.login}" required="true"
						disabled="#{usersBean.currentUserIsAdmin}" />
					
					<p:outputLabel for="isAdmin" value="Admin:" />
        			<p:selectBooleanCheckbox id="isAdmin" value="#{usersBean.admin}" >
        				<p:ajax update="url, pwd1, pwd2" />
        			</p:selectBooleanCheckbox>	
        			
        			<p:outputLabel for="url" value="URL:"/>
					<p:inputText id="url" value="#{usersBean.url}" disabled="#{usersBean.admin}"
						 required="#{!usersBean.admin}"  />
					
					<p:outputLabel for="pwd1" value="Password:" />
        			<p:password id="pwd1" match="pwd2" value="#{usersBean.password}" disabled="#{!usersBean.admin}"
        				required="#{usersBean.admin}" />
 
        			<p:outputLabel for="pwd2" value="Password confirmation:" />
        			<p:password id="pwd2" value="#{usersBean.password}" required="#{usersBean.admin}"
        				 disabled="#{!usersBean.admin}" />									
					
					<p:commandButton value="Save" update="userInfoForm" id="saveUser"
						icon="ui-icon-check" action="#{usersBean.changeUserInfo}" />
					<p:commandButton value="Cancel" id="cancel" onclick="PF('dlgUserInfo').hide();"
						icon="ui-icon-close" />   			
				</h:panelGrid>
					
			</p:dialog>
		</h:form>	
				
		<p:spacer height="10" />
				
		<h:form id="userList" >
			<p:dataTable id="userListTable" var="user" value="#{userListBean.users}">
    					
    			<p:column headerText="Login">
    				<h:outputText value="#{user.login}" />
    			</p:column>
    				
    			<p:column headerText="Name">
    				<h:outputText value="#{user.name}" />
    			</p:column>
    				
    			<p:column headerText="Role">
    				<h:outputText value="#{user.userRole}"/>
    			</p:column>	
    				
    				<p:column headerText="">
        				<p:commandLink value="Edit" style="margin:5px" oncomplete="PF('dlgUserInfo').show();"
        				 	actionListener="#{usersBean.loadFields(user.login)}" update=":userInfoForm">
        				 	<p:ajax />
        				 </p:commandLink>
        				
        				<p:commandLink value="Delete" style="margin:5px" actionListener="#{usersBean.deleteUser(user.login)}"
        						update=":userList:userListTable" >	 
        					<p:confirm header="Confirmation" message="Do you really want to remove user?" icon="ui-icon-alert" />			
        				</p:commandLink>
        				
        				<p:confirmDialog global="true" >
        					<div align="center">
								<p:commandButton value="Yes" type="button"
									styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
								<p:commandButton value="No" type="button"
									styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
							</div>		
						</p:confirmDialog>

    				</p:column>
    					
    				
				</p:dataTable>
			</h:form>
							
	 </div>
						
	</ui:define>
</ui:composition>    